generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  castles   Castle[]
  tribeType TribeType @relation(fields: [tribeId], references: [id])
  tribeId   String
}

model Castle {
  id              String           @id @default(uuid())
  x               Int
  y               Int
  user            User             @relation(fields: [userId], references: [id])
  userId          String
  castleResources CastleResources?
  unitGroups      UnitGroup[]
  attacksFrom     Attack[]         @relation("AttackCastleFrom")
  attacksTo       Attack[]         @relation("AttackCastleTo")
}

model CastleResources {
  id       String @id @default(uuid())
  gold     Int
  castle   Castle @relation(fields: [castleId], references: [id])
  castleId String @unique
}

model UnitType {
  id               String      @id @default(uuid())
  name             String
  attack           Int
  defence          Int
  speed            Int
  carryingCapacity Int
  cropConsumption  Int
  unitGroups       UnitGroup[]
}

model TribeType {
  id               String      @id @default(uuid())
  name             String
  users            User[]
}

model Attack {
  id           String      @id @default(uuid())
  castleFrom   Castle      @relation(name: "AttackCastleFrom", fields: [castleFromId], references: [id])
  castleFromId String
  castleTo     Castle      @relation(name: "AttackCastleTo", fields: [castleToId], references: [id])
  castleToId   String
  unitGroups   UnitGroup[]
  dateTime     DateTime
}

model UnitGroup {
  id            String   @id @default(uuid())
  unitType      UnitType @relation(fields: [unitTypeId], references: [id])
  unitTypeId    String
  amount        Int
  ownerCastle   Castle?  @relation(fields: [ownerCastleId], references: [id])
  ownerCastleId String?
  ownerAttack   Attack?  @relation(fields: [ownerAttackId], references: [id])
  ownerAttackId String?
}
